var configurator=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t){const r=Math.PI/180;e.exports={isIE:function(){return!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g)},isIE11:function(){return!(!navigator.userAgent.match(/Trident/g)&&!navigator.userAgent.match(/MSIE/g))&&!!navigator.userAgent.match(/rv:11/g)},toRadians:function(e){return e*r}}},function(e,t){var r=function(){this.listeners=[]};r.prototype.addListener=function(e){if(e){-1===this.listeners.indexOf(e)&&this.listeners.push(e)}},r.prototype.removeListener=function(e){if(e){let t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},r.prototype.emit=function(){let e=arguments;this.listeners.forEach(function(t){t.apply(null,e)})},e.exports={EventEmitter:r}},function(e,t,r){const a=r(0),n={};THREE.ShaderChunk.aomap_fragment="\n#ifdef USE_AOMAP\n    float aoLevel = aoSample;\n\n    aoSample = (aoLevel - 1.0) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= aoSample;\n\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, aoSample, material.specularRoughness );\n\n\t#endif\n\n#endif\n",THREE.ShaderChunk.lights_fragment_begin="\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n    \n    #ifdef USE_AOMAP\n        float tmpAo = aoSample;\n        tmpAo = (tmpAo - 1.0) * aoMapIntensity + 1.0;\n        tmpAo = smoothstep(0.0, 0.5, tmpAo);\n    #endif\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n        #endif\n        \n        #ifdef USE_AOMAP\n\n            // Include some of the AO map contribution to direct lights.\n            //tmpAo = aoSample;\n            //tmpAo = (tmpAo - 1.0) * aoMapIntensity + 1.0;\n            //tmpAo = smoothstep(0.0, 0.5, tmpAo);\n            \n            #ifdef USE_AOMAP\n                directLight.color *= tmpAo;\n            #endif\n        \n        #endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n\n#endif\n";const o=new THREE.Matrix3,i=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Vector3(0,0,1);function u(e){let t=[];o.setUvTransform(e.offset[0],e.offset[1],e.scale[0],e.scale[1],a.toRadians(e.angle),.5-e.offset[0],.5-e.offset[1]);for(var r=0;r<9;r++)t.push(o.elements[r]);let n=a.toRadians(e.angle);e.hasOwnProperty("mirrorAngle")&&!e.mirrorAngle||(n*=-1);let i=1;e.hasOwnProperty("mirrorX")&&e.mirrorX&&(i=-1),o.setUvTransform(-1*e.offset[0],e.offset[1],e.scale[0]*i,e.scale[1],n,.5- -1*e.offset[0],.5-e.offset[1]);for(r=0;r<9;r++)t.push(o.elements[r]);return t}function p(e){let t=[],r=e.scale[0]<0?-1:1,n=e.scale[1]<0?-1:1,o=a.toRadians(e.angle);i.makeScale(r,n,1),r!=n&&(o=-o),s.makeRotationAxis(l,o),i.multiply(s);for(var u=0;u<16;u++)t.push(i.elements[u]);r=e.scale[0]<0?-1:1,n=e.scale[1]<0?-1:1,o=a.toRadians(e.angle),i.makeScale(r,n,1),r==n&&(o=-o),s.makeRotationAxis(l,o),i.multiply(s);for(u=0;u<16;u++)t.push(i.elements[u]);return t}e.exports={makeUVUniformMirrored:u,makeNormalMapMatrix:p,CreateIridescentMaterial:function(e,t){var r={shared:{tiledTransform:t.transform}};let a={STANDARD:"",TEXTURE_LOD_EXT:""};var o=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,{transparent:e.transparent,maxMipLevel:{value:8},emissive:{value:new THREE.Color(e.emissive)},tiledTransforms:{value:u(t.transform)},specular:{value:new THREE.Color(e.specular)},glossiness:{value:e.glossiness},opacity:{value:e.opacity},specularPower:{value:e.specularPower},uvFlip:{value:0}}]);if(o.normalMap.value=e.normalMap,e.hasOwnProperty("diffuseMap")&&(a.USE_MAP="",a.USE_DIFFUSE_MAP="",o.diffuseMap={value:e.diffuseMap}),o.alphaMap={value:e.alphaMap},t.hasOwnProperty("colorMap")&&(o.colorMap={value:t.colorMap}),e.hasOwnProperty("normalMap")){a.USE_MAP="",a.USE_NORMALMAP="",r.shared.normalTiledMatrix=p(t.transform);let e=0,n=r.shared.normalTiledMatrix.slice(e,e+16);o.normalTiledMatrix={value:n}}return e.hasOwnProperty("normalScale")?o.normalScale.value.set(e.normalScale,e.normalScale):o.normalScale.value.set(1,1),new THREE.ShaderMaterial({lights:!0,extensions:{derivatives:!0,shaderTextureLOD:!0},transparent:!0,userData:r,defines:a,uniforms:o,depthWrite:!1,depthTest:!0,polygonOffset:!(0==e.polygonOffsetFactor),polygonOffsetFactor:e.polygonOffsetFactor,blending:THREE.AdditiveBlending,vertexShader:n.iridescent.vertex,fragmentShader:n.iridescent.fragment})},CreateTranslucentMaterial:function(e,t){var r={shared:{tiledTransform:t.transform}};let a={STANDARD:"",TRANSPARENT:"",TEXTURE_LOD_EXT:""};var o=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,{transparent:!0,maxMipLevel:{value:8},gumColor:{value:new THREE.Color(t.gumColor)},gumMix:{value:t.gumMix},interiorIntensity:{value:t.interiorIntensity},interiorDepth:{value:t.interiorDepth},emissive:{value:new THREE.Color(e.emissive)},tiledTransforms:{value:u(t.transform)},specular:{value:new THREE.Color(e.specular)},glossiness:{value:e.glossiness},opacity:{value:e.opacity},specularPower:{value:e.specularPower},uvFlip:{value:0}}]);if(o.diffuse={value:new THREE.Color(e.color)},o.interiorMap={value:t.interiorMap},e.aoMap&&(a.USE_MAP="",a.USE_AOMAP="",o.aoMap.value=e.aoMap),e.hasOwnProperty("diffuseMap")&&(a.USE_MAP="",a.USE_DIFFUSE_MAP="",o.diffuseMap={value:e.diffuseMap}),o.alphaMap={value:e.alphaMap},t.hasOwnProperty("colorMap")&&(o.colorMap={value:t.colorMap}),e.hasOwnProperty("normalMap")){a.USE_MAP="",a.USE_NORMALMAP="",o.normalMap.value=e.normalMap,r.shared.normalTiledMatrix=p(t.transform);let n=0,i=r.shared.normalTiledMatrix.slice(n,n+16);o.normalTiledMatrix={value:i}}if(e.hasOwnProperty("normalScale")?o.normalScale.value.set(e.normalScale,e.normalScale):o.normalScale.value.set(1,1),t.hasOwnProperty("colorMap")){a.USE_MAP="",a.USE_COLOR_LOOKUP="",o.colorMap={value:t.colorMap},r.shared.colorList=[],r.shared.colorCount=t.colorCount,r.shared.colorSteps=t.colorSteps;for(var i=0;i<r.shared.colorCount;i++)r.shared.colorList.push("#ffffff");var s=r.shared.colorCount*r.shared.colorSteps,l=new Uint8Array(4*s);for(i=0;i<s;i++){let e=4*i;l[e]=255,l[e+1]=255,l[e+2]=255,l[e+3]=0}let e=new THREE.DataTexture(l,s,1,THREE.RGBAFormat);e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0,a.COLOR_LOOKUP_TEXEL_RANGE=1-1/r.shared.colorCount,a.COLOR_LOOKUP_TEXEL_OFFSET=1/r.shared.colorCount/2,o.colorLookupMap={value:e}}return new THREE.ShaderMaterial({lights:!0,extensions:{derivatives:!0,shaderTextureLOD:!0},transparent:!0,userData:r,defines:a,uniforms:o,depthWrite:!0,depthTest:!0,blending:THREE.NormalBlending,vertexShader:n.translucent.vertex,fragmentShader:n.translucent.fragment})},CreateTiledMaterial_:function(e,t){let r=t.renderOrder;var a={shared:{tiledTransform:t.transform}},o=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,{transparent:e.transparent,maxMipLevel:{value:8},bumpScale:{value:.1},aoMap:{value:null},aoMapIntensity:{value:1.15},emissive:{value:new THREE.Color(e.emissive)},tiledTransforms:{value:u(t.transform)},specular:{value:new THREE.Color(e.specular)},glossiness:{value:e.glossiness},specularPower:{value:e.specularPower},uvFlip:{value:0}}]);o.aoChannelMask={value:t.aoChannelMask},e.hasOwnProperty("normalScale")?o.normalScale.value.set(e.normalScale,e.normalScale):o.normalScale.value.set(1,1),e.hasOwnProperty("specularColor")&&(o.specular={value:new THREE.Color(e.specularColor)}),o.diffuse={value:new THREE.Color(e.color)},o.normalMap.value=e.normalMap;let i={STANDARD:"",TEXTURE_LOD_EXT:""};if(e.aoMap&&(i.USE_MAP="",i.USE_AOMAP="",o.aoMap.value=e.aoMap),e.hasOwnProperty("normalMap")){i.USE_MAP="",i.USE_NORMALMAP="",a.shared.normalTiledMatrix=p(t.transform);let e=0,r=a.shared.normalTiledMatrix.slice(e,e+16);o.normalTiledMatrix={value:r}}if(e.transparent&&(i.TRANSPARENT="",o.opacity={value:e.opacity},o.opticalDensity={value:0}),t.translucent&&(i.TRANSLUCENT="",o.opticalDensity={value:t.opticalDensity}),e.cutout&&(i.CUT_OUT=""),e.useEnvMap&&(i.USE_ENVMAP="",i.ENVMAP_TYPE_CUBE="",i.ENVMAP_BLENDING_ADD="",o.flipEnvMap={value:1},o.reflectivity={value:e.reflectivity},o.specularStrength={value:e.specularPower},o.envMap={value:e.envMap}),e.hasOwnProperty("diffuseMap")&&(i.USE_MAP="",i.USE_DIFFUSE_MAP="",o.diffuseMap={value:e.diffuseMap}),t.hasOwnProperty("colorMap")){i.USE_MAP="",i.USE_COLOR_LOOKUP="",o.colorMap={value:t.colorMap},a.shared.colorList=[],a.shared.colorCount=t.colorCount,a.shared.colorSteps=t.colorSteps;for(var s=0;s<a.shared.colorCount;s++)a.shared.colorList.push("#ffffff");var l=a.shared.colorCount*a.shared.colorSteps,c=new Uint8Array(4*l);for(s=0;s<l;s++){let e=4*s;c[e]=255,c[e+1]=255,c[e+2]=255,c[e+3]=0}let e=new THREE.DataTexture(c,l,1,THREE.RGBAFormat);e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0,i.COLOR_LOOKUP_TEXEL_RANGE=1-1/a.shared.colorCount,i.COLOR_LOOKUP_TEXEL_OFFSET=1/a.shared.colorCount/2,o.colorLookupMap={value:e}}if(t.hasOwnProperty("substanceMap")&&(i.USE_MAP="",i.USE_SUBSTANCE="",o.substanceMap={value:t.substanceMap},o.substanceMin={value:(new THREE.Vector3).fromArray(t.substanceMin)},o.substanceMax={value:(new THREE.Vector3).fromArray(t.substanceMax)}),t.hasOwnProperty("pattern")&&(r++,i.USE_PATTERN="",i.USE_MAP="",o.patternTintThreshold={value:t.pattern.tintThreshold},o.patternGlossiness={value:t.pattern.glossiness},o.patternSpecularPower={value:t.pattern.specularPower},o.patternThickness={value:t.pattern.thickness},o.patternDiffuse={value:new THREE.Color(t.pattern.color)},o.patternEmissive={value:new THREE.Color(t.pattern.emissive)},o.patternDiffuseMap={value:t.pattern.diffuseMap},a.shared.patternTransform=t.pattern.transform,o.patternTransforms={value:u(t.pattern.transform)},t.pattern.hasOwnProperty("substanceMap")&&(i.USE_PATTERN_SUBSTANCE="",o.patternSubstanceMap={value:t.pattern.substanceMap}),t.pattern.hasOwnProperty("normalMap"))){o.patternNormalMap={value:t.pattern.normalMap};let e=0,r=p(t.pattern.transform).slice(e,e+16);o.patternNormalMatrix={value:r},a.shared.patternNormalMatrix=p(t.pattern.transform),t.pattern.hasOwnProperty("normalScale")?o.patternNormalScale={value:t.pattern.normalScale}:o.patternNormalScale={value:1},i.USE_PATTERN_NORMAL=""}t.hasOwnProperty("decal")&&(r++,i.USE_DECAL="",i.USE_MAP="",o.decalTintThreshold={value:t.decal.tintThreshold},o.decalGlossiness={value:t.decal.glossiness},o.decalSpecularPower={value:t.decal.specularPower},o.decalThickness={value:t.decal.thickness},o.decalDiffuse={value:new THREE.Color(t.decal.color)},o.decalDiffuseMap={value:t.decal.diffuseMap},a.shared.decalTransform=t.decal.transform,o.decalTransforms={value:u(t.decal.transform)},t.decal.hasOwnProperty("normalMap")&&(o.decalNormalMap={value:t.decal.normalMap},i.USE_DECAL_NORMAL=""));var d=!!e.hasOwnProperty("transparent")&&e.transparent;a.renderOrder=r;let f=THREE.FrontSide;switch(e.side){case"front":f=THREE.FrontSide;break;case"back":f=THREE.BackSide;break;case"double":f=THREE.DoubleSide}return new THREE.ShaderMaterial({lights:!0,extensions:{derivatives:!0,shaderTextureLOD:!0},transparent:d,side:f,userData:a,defines:i,uniforms:o,depthWrite:0==e.polygonOffsetFactor,depthTest:!0,polygonOffset:!(0==e.polygonOffsetFactor),polygonOffsetFactor:e.polygonOffsetFactor,blending:THREE.NormalBlending,vertexShader:n.tiled_sg.vertex,fragmentShader:n.tiled_sg.fragment})},CreateCanvas:function(e,t){var r=document.createElement("canvas");return r.width=e,r.height=t,r},Initialize:function(e,t){let r=["tiled_sg","translucent","iridescent"],a=new THREE.FileLoader;a.setResponseType("text");let o=2*r.length;for(var i=0;i<r.length;i++){let s=r[i];n[s]={vertex:"",fragment:""},a.load(e+"/"+s+".vert.glsl",function(e){n[s].vertex=e,--o<=0&&(console.log(n),t())}),a.load(e+"/"+s+".frag.glsl",function(e){n[s].fragment=e,--o<=0&&(console.log(n),t())})}}}},function(e,t,r){"use strict";r.r(t),r.d(t,"SetLightProperties",function(){return ae}),r.d(t,"GetAttachmentScreenPosition",function(){return oe}),r.d(t,"SetDragMode",function(){return me}),r.d(t,"getComponentByName",function(){return he}),r.d(t,"getComponentsByName",function(){return Ee}),r.d(t,"Initialize",function(){return Re}),r.d(t,"SetVisible",function(){return Pe}),r.d(t,"SetAllVisible",function(){return Oe}),r.d(t,"SetWallTexture",function(){return xe}),r.d(t,"SetComponentTexture",function(){return Se}),r.d(t,"SetComponentUniform",function(){return De}),r.d(t,"SetComponentColorList",function(){return Ae}),r.d(t,"SetComponentColor",function(){return He}),r.d(t,"GetContainer",function(){return Ce}),r.d(t,"GetRenderingContext",function(){return Le}),r.d(t,"LoadAssets",function(){return _e}),r.d(t,"SetPoseTweenAmount",function(){return Ie}),r.d(t,"SetLightTweenAmount",function(){return Ue}),r.d(t,"SetCameraTweenAmount",function(){return Fe}),r.d(t,"SetCameraPose",function(){return ke}),r.d(t,"SetShoePose",function(){return Ve}),r.d(t,"SetShoeGroupPose",function(){return Ne}),r.d(t,"SetLightPose",function(){return je}),r.d(t,"SetLightLevels",function(){return Be}),r.d(t,"SetSoftShadow",function(){return Ge}),r.d(t,"SetDecalTransform",function(){return We}),r.d(t,"SetTileTransform",function(){return Qe}),r.d(t,"CenterCameraOnComponent",function(){return ze}),r.d(t,"GetComponentScreenPosition",function(){return Xe}),r.d(t,"GetCanvas",function(){return Ye}),r.d(t,"CommitCanvas",function(){return qe}),r.d(t,"OnFrame",function(){return Ke}),r.d(t,"ExportImage",function(){return Je}),r.d(t,"SetComponentMaterial",function(){return $e}),r.d(t,"SetBackgroundOpacity",function(){return et}),r.d(t,"SetActiveShoeId",function(){return tt}),r.d(t,"GetComponentAtCursor",function(){return rt}),r.d(t,"GetColors",function(){return at}),r.d(t,"GetMaterials",function(){return nt}),r.d(t,"GetViewState",function(){return ot}),r.d(t,"LookAtAttachment",function(){return it}),r.d(t,"on",function(){return st}),r.d(t,"off",function(){return lt}),r.d(t,"ForceRender",function(){return ut});r(4);const a=r(1),n=r(0),o=r(5),i=r(6),s=r(7),l=r(8),u=r(2);var p=new THREE.Raycaster,c={};function d(e){return e*Math.PI/180}function f(e){return 180*e/Math.PI}function m(e){T[v].emit(e)}const h="frame",E="click",v="error",g="hover",w="dragstart",y="dragend",T={hover:new a.EventEmitter,click:new a.EventEmitter,frame:new a.EventEmitter,error:new a.EventEmitter,dragstart:new a.EventEmitter,dragend:new a.EventEmitter},M={shoeId:"",groupId:"",component:""};var R,P,O,x,S,D,b,A,H,C,L,_,I,U,F=new THREE.Color(16777215),k=1,V=!0,N=!1,j=1,B={};const G={frames:0,models:[],triangles:0,calls:0,shadowTriangles:0,shadowCalls:0,verteces:0};for(var W,Q=!1,z=0,X=0,Y=[],q=0,K=new THREE.Quaternion,Z=0;Z<30;Z++)Y.push(0);function J(){N=!0}function $(){H=window.innerWidth,A=window.innerHeight;var e=H/A;O.aspect=e,O.updateProjectionMatrix(),S.setSize(H,A),J()}function ee(e){if(requestAnimationFrame(ee),!e)return;var t=e-X;if(X=e,t>120)return;Y[q]=t;let r=0;for(var a=0;a<Y.length;a++)r+=Y[a];r/=Y.length,++q>=Y.length&&(q=0),r>50&&(Q=!0);let n=i.Manager.Update(.001*t);for(var o in c)for(var s in c[o].container.position.copy(c[o].pose.position.current),c[o].container.rotation.setFromQuaternion(c[o].pose.rotation.current),c[o].groups){let e=c[o].groups[s];e.position.copy(e.userData.pose.position.current),e.rotation.setFromQuaternion(e.userData.pose.rotation.current)}_.position.copy(pe.current),_.target.position.copy(ce.current),L.position.copy(_.position),L.lookAt(x.position),O.position.copy(le.current),O.lookAt(ue.current),b&&(b.rotation.y+=.01);let l=N||n;l&&(te(),T[h].emit(l),N=!1)}function te(){if(V){if(!Q||z%2!=0){for(var e in U&&(U.visible=!0),L.position.copy(_.position),L.lookAt(_.target.position),S.autoClear=!0,C.visible=!1,D.visible=!0,c){c[e].container.children.forEach(function(e){let t=0,r=null;e.children.forEach(function(e){e.userData.isVisible=e.visible,t+=e.visible?1:0,e.userData.isShadow?e.userData.isBounds&&(r=e):e.visible=!1}),t>0&&null!=r&&(r.visible=!0)})}for(var e in o.Render(S,x),U&&(U.visible=!1),c){c[e].container.children.forEach(function(e){e.children.forEach(function(e){e.visible=e.userData.isVisible})})}C.visible=!0,x.overrideMaterial=null}z++}else C.visible=!1;C.visible=!0,D.visible=!0,S.setClearColor(F,k),S.render(x,O)}function re(e){var t=e.hasOwnProperty("color")?e.color:"#ffffff",r=e.hasOwnProperty("intensity")?e.intensity:1,a=e.hasOwnProperty("position")?e.position:[0,0,0],n=e.hasOwnProperty("name")?e.name:"";switch(e.type){case"directional":var o=new THREE.DirectionalLight(t,r);o.name=n,o.position.set(a[0],a[1],a[2]),o.target=D,B[n]=o,x.add(o)}}function ae(e,t){if(B[e]){let r=B[e];t.hasOwnProperty("color")&&r.color.set(t.color),t.hasOwnProperty("intensity")&&(r.intensity=t.intensity),t.hasOwnProperty("position")&&r.position.set(t.position[0],t.position[1],t.position[2])}}function ne(e){!function(){for(var e=new Uint8Array(4),t=0;t<4;t++)e[t]=255;(R=new THREE.DataTexture(e,1,1,THREE.RGBAFormat)).name="blank",R.wrapS=R.wrapT=THREE.ClampToEdgeWrapping,R.minFilter=THREE.NearestFilter,R.magFilter=THREE.NearestFilter,R.generateMipmaps=!1,R.needsUpdate=!0}(),x=new THREE.Scene,H=window.innerWidth,A=window.innerHeight;var t=H/A;O=new THREE.PerspectiveCamera(60,t,1,1e4),I=new THREE.AmbientLight(16777215,.4,20,30),x.add(I);var r=new THREE.Object3D;if(x.add(r),(_=new THREE.DirectionalLight(16777215,.5)).target=r,x.add(_),L=new THREE.PerspectiveCamera(40,t,1,1e4),o.Initialize(L),(C=new THREE.Mesh(new THREE.PlaneBufferGeometry(250,250),o.CreateMaterial(R))).position.set(0,0,-9),x.add(C),x.add(O),D=new THREE.Object3D,x.add(D),e.hasOwnProperty("lighting"))for(var a=0;a<e.lighting.length;a++)re(e.lighting[a]);J(),window.addEventListener("resize",$)}function oe(e,t){if(!c[e]||!c[e].attachments.hasOwnProperty(t))return null;var r=c[e].attachments[t];let a=null,n=r.hasOwnProperty("group")&&r.group;a=n?c[e].groups[r.group]:c[e].container;var o=(new THREE.Vector3).copy(r.position),i=ie(a,o,O);o.applyMatrix4(a.matrixWorld);var s=new THREE.Vector3;s.copy(o),s.sub(O.position),s.normalize();var l=new THREE.Vector3(0,0,-1);return a.getWorldQuaternion(K),l.applyQuaternion(r.quaternion),l.applyQuaternion(K),{group:n?r.group:null,position:i,facing:s.dot(l)}}function ie(e,t,r){var a=new THREE.Vector3;a.copy(t);var n=.5*S.context.canvas.width,o=.5*S.context.canvas.height;return a.applyMatrix4(e.matrixWorld),a.project(r),a.x=a.x*n+n,a.y=-a.y*o+o,a.x/=j,a.y/=j,{x:a.x,y:a.y}}function se(e){return!!c.hasOwnProperty(e)}var le=new i.EasedPosition,ue=new i.EasedPosition,pe=new i.EasedPosition,ce=new i.EasedPosition,de=null,fe=null;function me(e,t){var r=null;null!=t&&(r={x:t[0],y:t[1]}),W.SetDragMode(e,r)}function he(e,t){if(c[e])return c[e].container.getObjectByName(t)}function Ee(e,t){let r=[],a=-1!==t.indexOf("*"),n=t.replace(/\*/g,".*"),o=new RegExp("^"+n+"$");if(c[e])for(var i in c[e].models)c[e].models[i].userData.isBounds||(a&&o.test(i)?r.push(c[e].models[i]):i==t&&r.push(c[e].models[i]));return r}function ve(e,t,r){let a=t+"Transforms",n=t+"Transform",o="base"+(t.charAt(0).toUpperCase()+t.substr(1))+"Transform";if(e.uniforms&&e.uniforms.hasOwnProperty(a)){let t=l.GetTileParams(r,e.userData.shared[o]),i=e.userData.shared[n];return e.uniforms[a].value=u.makeUVUniformMirrored(t),i.offset=t.offset,i.scale=t.scale,i.angle=t.angle,i.mirrorX=t.mirrorX,i.mirrorAngle=t.mirrorAngle,t}return null}var ge={},we=new THREE.Quaternion,ye=new THREE.Quaternion,Te=new THREE.Quaternion,Me=new THREE.Quaternion;function Re(e,t){for(var r=(ge=e).start_pose.shoe_angle,a=ge.start_pose.plane_angle,n=ge.end_pose.shoe_angle,o=ge.end_pose.plane_angle,i=0;i<3;i++)r[i]=r[i]*Math.PI/180,a[i]=a[i]*Math.PI/180,n[i]=n[i]*Math.PI/180,o[i]=o[i]*Math.PI/180;we.setFromEuler(new THREE.Euler(a[0],a[1],a[2],"XYZ")),ye.setFromEuler(new THREE.Euler(r[0],r[1],r[2],"XYZ")),Te.setFromEuler(new THREE.Euler(o[0],o[1],o[2],"XYZ")),Me.setFromEuler(new THREE.Euler(n[0],n[1],n[2],"XYZ")),ne(e),function(e){P=document.getElementById("viewport");let t=1==window.devicePixelRatio,r=1.25;e.hasOwnProperty("antialias")&&(t=e.antialias),e.hasOwnProperty("max_pixel_ratio")&&(r=e.max_pixel_ratio),(S=new THREE.WebGLRenderer({alpha:!0,stencil:!0,antialias:t,tonemapping:THREE.Uncharted2ToneMapping,canvas:P})).setSize(H,A),j=Math.min(r,window.devicePixelRatio),S.setPixelRatio(j),S.autoClear=!0,e.hasOwnProperty("exposure")&&(S.toneMappingExposure=e.exposure)}(e),(W=new s).Initialize(S.domElement,function(e,t){if(de)if(fe){let e=new THREE.Matrix4;e.getInverse(de.container.matrixWorld);let r=new THREE.Vector3(0,1,0);r.applyMatrix4(e);let a=new THREE.Vector3(1,0,0);a.applyMatrix4(e);let n=new THREE.Vector3(0,0,1);n.applyMatrix4(e);let o=new THREE.Quaternion;o.setFromAxisAngle(n,fe.userData.pose.angle[2]),o.normalize();let i=new THREE.Quaternion;fe.userData.pose.angle[1]+=t.y,i.setFromAxisAngle(r,fe.userData.pose.angle[1]),i.normalize();let s=new THREE.Quaternion;fe.userData.pose.angle[0]+=t.x,s.setFromAxisAngle(a,fe.userData.pose.angle[0]),s.normalize(),s.multiply(i),s.multiply(o),fe.userData.pose.rotation.Set(s),J()}else{de.pose.angle[0]+=t.x,de.pose.angle[1]+=t.y;let e=de.pose.angle[0],r=de.pose.angle[1],a=de.pose.angle[2],n=new THREE.Euler(e,r,a),o=new THREE.Quaternion;o.setFromEuler(n),de.pose.rotation.Set(o),J()}},function(e,t){let r,a=e/window.innerWidth,n=t/window.innerHeight,o=new THREE.Vector2;for(var i in o.set(2*a-1,-2*n+1),p.setFromCamera(o,O),c)for(var s in c[i].groups){let e=p.intersectObjects(c[i].groups[s].children);e.length>0&&(null==r||r.distance>e[0].distance)&&(r=e[0])}let l=null,u=null,d=null;r&&(d=r.object.name,u=r.object.parent.name,l=r.object.parent.parent.name),T[E].emit({x:e,y:t,shoe:l,group:u,component:d})},function(e,t){let r,a=e/window.innerWidth,n=t/window.innerHeight,o=new THREE.Vector2;for(var i in o.set(2*a-1,-2*n+1),p.setFromCamera(o,O),c){let e=[];if(c[i].boundsObjects.length>0){for(var s=0;s<c[i].boundsObjects.length;s++)c[i].boundsObjects[s].visible=!0;p.intersectObjects(c[i].boundsObjects,!1,e);for(s=0;s<c[i].boundsObjects.length;s++)c[i].boundsObjects[s].visible=!1}else p.intersectObjects(c[i].container.children,!1,e);e.length>0&&(null==r||r.distance>e[0].distance)&&(r=e[0])}let l=null,u=null;r&&(l=r.object.userData.shoe,u=r.object.userData.group),M.shoeId==l&&u==M.groupId||(M.shoeId=l,M.groupId=u,T[g].emit({x:e,y:t,shoe:l,group:u}))},function(e){e?T[w].emit():T[y].emit()}),W.ResetConstraints(),ee();let u=e.hasOwnProperty("paths")?e.paths:{};u.maxAnisotropy=S.capabilities.getMaxAnisotropy(),l.Initialize(u,function(){e.hasOwnProperty("environment")&&l.LoadEnvironmentMap("default",e.environment),t()})}function Pe(e,t,r){let a=Ee(e,t);a.forEach(function(e){e.userData.isBounds||(e.visible=r)}),a.length>0&&J()}function Oe(e,t){if(se(e)){if(c[e]){for(var r in c[e].models){let a=c[e].models[r];a.userData.isBounds||(a.visible=t)}J()}}else m("SetAllVisible: Invalid shoe id `"+e+"`")}function xe(e,t,r){e?C.material.map=l.GetTexture(e,function(){J()}):(C.material.map=R,J()),t?(C.material.map.wrapS=C.material.map.wrapT=THREE.RepeatWrapping,C.material.map.repeat.set(t,t),J()):(C.material.map.wrapS=C.material.map.wrapT=THREE.RepeatWrapping,C.material.map.repeat.set(1,1),J()),r?(F.set(r),S.setClearColor(F),C.material.color.set(F),J()):(F.set(16777215),S.setClearColor(F),C.material.color.set(F),J())}function Se(e,t,r,n){if(!se(e))return void m("SetComponentTexture: Invalid shoe id `"+e+"`");if(0===n.indexOf("canvas:")){let a=n.substring("canvas:".length),o=c[e].canvases[a];return void Ee(e,t).forEach(function(e){e.material.hasOwnProperty[r]?e.material[r]=o.texture:e.material.uniforms&&e.material.uniforms.hasOwnProperty(r)&&(e.material.uniforms[r].value=o.texture)})}var o=c[e];if(0===n.indexOf("null:")){let a=l.GetNullTexture(n.substring("null:".length));return void Ee(e,t).forEach(function(e){e.material.hasOwnProperty[r]?e.material[r]=a:e.material.uniforms&&e.material.uniforms.hasOwnProperty(r)&&(e.material.uniforms[r].value=a)})}if(null==o.textures[n].texture){o.textures[n].ready=!1,o.textures[n].onReady=new a.EventEmitter,o.textures[n].texture=l.GetTexture(o.textures[n].url,function(e){o.textures[n].ready=!0,o.textures[n].onReady.emit()});let e=o.textures[n].repeat,t=o.textures[n].mipmaps,r=o.textures[n].filtering;o.textures[n].texture.wrapS=o.textures[n].texture.wrapT=e?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,t||(o.textures[n].texture.minFilter=THREE.LinearFilter,o.textures[n].texture.generateMipmaps=!1),r||(o.textures[n].texture.minFilter=THREE.NearestFilter,o.textures[n].texture.magFilter=THREE.NearestFilter)}let i=r;Ee(e,t).forEach(function(e){e.material.userData.shared[i]=n}),o.textures[n].ready?(Ee(e,t).forEach(function(e){e.material.uniforms&&e.material.uniforms.hasOwnProperty(i)?e.material.uniforms[i].value=o.textures[n].texture:e.material.hasOwnProperty(i)&&(e.material[i]=o.textures[n].texture)}),J()):o.textures[n].onReady.addListener(function(){Ee(e,t).forEach(function(e){e.material.userData.shared[i]==n&&(e.material.uniforms&&e.material.uniforms.hasOwnProperty(i)?e.material.uniforms[i].value=o.textures[n].texture:e.material.hasOwnProperty(i)&&(e.material[i]=o.textures[n].texture))}),J()})}function De(e,t,r,a){if(se(e)){var n=c[e];if(null==n.textures[a].texture){n.textures[a].texture=l.GetTexture(n.textures[a].url,function(){Ee(e,t).forEach(function(e){e.material.uniforms[r].value=n.textures[a].texture}),J()}),(!n.textures[a].hasOwnProperty("repeat")||n.textures[a].repeat)&&(n.textures[a].texture.wrapS=n.textures[a].texture.wrapT=THREE.RepeatWrapping)}else Ee(e,t).forEach(function(e){e.material.uniforms[r].value=n.textures[a].texture}),J()}else m("SetComponentUniform: Invalid shoe id `"+e+"`")}function be(e,t,r){var a=t.image.data;let n=0,o=e.shared.colorSteps,i=e.shared.colorCount,s=r;if(r.length<i)console.log("Not enough colors in the color array, expected: "+i);else{if(!Array.isArray(r)){s=[];for(var l=0;l<i;l++)s.push(r)}for(l=0;l<i;l++)if(null!==s[l]){let t=0,r=0;if(e.shared.colorList[l]=s[l],-1!==s[l].indexOf(":")){let e=s[l].split(":"),a=e[0].replace("#","");t=parseInt(a,16),r=parseFloat(e[1]),r=Math.floor(255*r)}else{let e=s[l].replace("#","");t=parseInt(e,16)}let i=t>>16&255,p=t>>8&255,c=255&t;n=l*o*4;for(var u=0;u<o;u++)a[n]=i,a[n+1]=p,a[n+2]=c,a[n+3]=r,n+=4}t.needsUpdate=!0,J()}}function Ae(e,t,r){let a=Ee(e,t);for(var n=0;n<a.length;n++)a[n].material.uniforms.hasOwnProperty("colorLookupMap")&&be(a[n].material.userData,a[n].material.uniforms.colorLookupMap.value,r)}function He(e,t,r,a){if(!se(e))return void m("SetComponentColor: Invalid shoe id `"+e+"`");let n=t,o="base";if(-1!==t.indexOf(":")){let e=t.split(":");n=e[0],o=e[1]}let i=r,s=Ee(e,n),l="",u=void 0!==a?a:0,p=!1;if(-1!==r.indexOf(":")){let e=i.split(":");i=e[0],u=parseFloat(e[1])}0===i.indexOf("#")?l=i:Array.isArray(i)||c[e].colors.hasOwnProperty(i)&&(l=c[e].colors[i],p=!0);for(var d=0;d<s.length;d++){let t=u,a=l,n=s[d].material.userData.shared.materialType,f=s[d].material.userData.shared.colors;s[d].material.userData.shared.colorName=p&&"base"==o?i:null;let h=s[d].material.userData.shared.info;if(h.hasOwnProperty("colors")&&h.colors.hasOwnProperty(i)&&(a=h.colors[i]),f&&f.hasOwnProperty(r)&&(a=f[r]),n&&(c[e].materialTypes.hasOwnProperty(n)?c[e].materialTypes[n].hasOwnProperty("colors")&&c[e].materialTypes[n].colors.hasOwnProperty(i)&&(a=c[e].materialTypes[n].colors[i]):m("SetComponentColor: component `"+s[d].name+"` is assigned to an unknown material type `"+n+"`")),-1!==a.indexOf(":")){let e=a.split(":");a=e[0],t=parseFloat(e[1])}s[d].material.uniforms?s[d].material.uniforms.hasOwnProperty("colorLookupMap")?be(s[d].material.userData,s[d].material.uniforms.colorLookupMap.value,a):"base"==o?(s[d].material.uniforms.emissive.value.set(a),s[d].material.uniforms.emissive.value.multiplyScalar(t),s[d].material.userData.shared.colorBoost=t,s[d].material.uniforms.diffuse.value.set(a)):"pattern"==o&&s[d].material.uniforms.hasOwnProperty("patternDiffuse")?(s[d].material.uniforms.patternEmissive.value.set(a),s[d].material.uniforms.patternEmissive.value.multiplyScalar(t),s[d].material.userData.shared.patternColorBoost=t,s[d].material.uniforms.patternDiffuse.value.set(a)):"decal"==o&&s[d].material.uniforms.hasOwnProperty("decalDiffuse")&&s[d].material.uniforms.decalDiffuse.value.set(a):(s[d].material.hasOwnProperty("emissive")&&(s[d].material.emissive.set(a),s[d].material.emissive.multiplyScalar(t)),s[d].material.userData.shared.colorBoost=t,s[d].material.color=new THREE.Color(a))}s.length>0&&J()}function Ce(){return c}function Le(){return{scene:x,renderer:S,stats:G}}function _e(e,t,r){l.LoadManifest(e,function(e,t){D.add(t)},function(e,r){for(var a in c[e]=r,c[e].pose={angle:[0,0,0],position:new i.EasedPosition,rotation:new i.EasedRotation},c[e].groups)c[e].groups[a].userData.pose={angle:[0,0,0],position:new i.EasedPosition,rotation:new i.EasedRotation},c[e].groups[a].userData.pose.position.Set(c[e].groups[a].position,!0);J(),t&&t()},r)}function Ie(e,t,r){if(se(e)){var a=new THREE.Quaternion;THREE.Quaternion.slerp(we,Te,a,t),C.rotation.setFromQuaternion(a),c[e]&&(THREE.Quaternion.slerp(ye,Me,a,t),c[e].pose.rotation.Set(a,!0)),J()}else m("SetPoseTweenAmount: Invalid shoe id `"+e+"`")}function Ue(e,t){var r=(new THREE.Vector3).fromArray(ge.light.min.position),a=(new THREE.Vector3).fromArray(ge.light.max.position);let n=new THREE.Vector3;n.lerpVectors(r,a,e),pe.Set(n,t),J()}function Fe(e,t){var r=(new THREE.Vector3).fromArray(ge.camera.min.position),a=(new THREE.Vector3).fromArray(ge.camera.max.position),n=(new THREE.Vector3).fromArray(ge.camera.min.target),o=(new THREE.Vector3).fromArray(ge.camera.max.target);n.lerpVectors(n,o,e),r.lerpVectors(r,a,e),le.Set(r,t),ue.Set(n,t),J()}function ke(e,t,r){le.Set(e,r),ue.Set(t,r),J()}function Ve(e,t,r,a){se(e)?(c[e].pose.angle[0]=n.toRadians(r[0]),c[e].pose.angle[1]=n.toRadians(r[1]),c[e].pose.angle[2]=n.toRadians(r[2]),c[e].pose.rotation.Set(r,a),c[e].pose.position.Set(t,a),de&&de==c[e]&&W.ResetConstraints(),J()):m("SetShoePose: Invalid shoe id `"+e+"`")}function Ne(e,t,r,a,o){if(!se(e))return void m("SetShoeGroupPose: Invalid shoe id `"+e+"`");if(!c[e].groups.hasOwnProperty(t))return void m("SetShoeGroupPose: Invalid group id `"+t+"`");let i=c[e].groups[t];i.userData.pose.angle[0]=n.toRadians(a[0]),i.userData.pose.angle[1]=n.toRadians(a[1]),i.userData.pose.angle[2]=n.toRadians(a[2]),i.userData.pose.rotation.Set(a,o),i.userData.pose.position.Set(r,o),de&&fe&&fe==i&&W.ResetConstraints(),J()}function je(e,t,r){pe.Set(e,r),ce.Set(t,r),J()}function Be(e,t,r){for(var a in _.intensity=e,I.intensity=t,c){let e=c[a].materials;for(var n in e)e[n].hasOwnProperty("aoMapIntensity")?e[n].aoMapIntensity=r:e[n].uniforms.hasOwnProperty("aoMapIntensity")&&(e[n].uniforms.aoMapIntensity.value=r)}J()}function Ge(e,t){L.fov=e,L.updateProjectionMatrix(),o.SetIntensity(t),J()}function We(e,t,r,a,n,o,i){if(se(e)){var s=he(e,t);s&&(s.material.userData.params.decal.transform.x=r,s.material.userData.params.decal.transform.y=a,s.material.userData.params.decal.transform.scale=n,s.material.userData.params.decal.transform.angle=i,s.material.userData.decal.transform.value.setUvTransform(r,a,n,o,d(i),.5-r,.5-a),J())}else m("SetDecalTransform: Invalid shoe id `"+e+"`")}function Qe(e,t,r,a,n,o,i){if(se(e)){var s=he(e,t);s&&(s.material.userData.transform.offset=[r,a],s.material.userData.transform.scale=[n,o],s.material.userData.transform.angle=i,s.material.userData.transform.value.setUvTransform(r,a,n,o,d(i),.5-r,.5-a),J())}else m("SetTileTransform: Invalid shoe id `"+e+"`")}function ze(e,t,r){if(se(e)){var a=he(e,t);if(a){var n=new THREE.Vector3;n.copy(a.userData.centerPoint),n.applyMatrix4(a.matrixWorld),ue.Set(n),le.Set([n.x,n.y,n.z+r])}}else m("CenterCameraOnComponent: Invalid shoe id `"+e+"`")}function Xe(e,t){if(se(e)){var r=he(e,t);if(r){var a=ie(r,r.userData.centerPoint,O),n=new THREE.Vector3;n.copy(r.userData.centerPoint),n.applyMatrix4(c[e].container.matrixWorld);var o=new THREE.Vector3;o.copy(n),o.sub(O.position),o.normalize();var i=new THREE.Vector3;return i.copy(r.userData.centerPoint),i.normalize(),i.applyQuaternion(c[e].container.quaternion),{x:a.x,y:a.y,facing:o.dot(i)}}return null}m("GetComponentScreenPosition: Invalid shoe id `"+e+"`")}function Ye(e,t){if(se(e))return c[e].canvases.hasOwnProperty(t)?{canvasId:t,shoeId:e,context:c[e].canvases[t].context,width:c[e].canvases[t].width,height:c[e].canvases[t].height}:(m("GetCanvas: Invalid canvas ID `"+t+"` for shoe id `"+e+"`"),null);m("GetCanvas: Invalid shoe id `"+e+"`")}function qe(e){c[e.shoeId].canvases.hasOwnProperty(e.canvasId)?(c[e.shoeId].canvases[e.canvasId].texture.needsUpdate=!0,J()):m("CommitCanvas: Invalid canvas.")}function Ke(e){T[h].addListener(e)}function Ze(e,t){for(var r in e)"pattern"==r||"decal"==r?(t.hasOwnProperty(r)||(t[r]={}),Ze(e[r],t[r])):t[r]=e[r]}function Je(){S.preserveDrawingBuffer=!0,te();var e=S.domElement.toDataURL("image/png");return S.preserveDrawingBuffer=!1,e}function $e(e,t,r){if(se(e)){for(var a=c[e].materialTypes,n=r.split(","),o=(r=n[n.length-1],{}),i=0;i<n.length;i++){Ze(a[n[i]],o)}Ee(e,t).forEach(function(t){var a=t.name;for(var n in o){var i=o[n];switch(n){case"transform":let r=ve(t.material,"tiled",i);if(t.material.uniforms.hasOwnProperty("normalMap")&&null!=r){let e=16*t.material.uniforms.uvFlip.value,a=u.makeNormalMapMatrix(r).slice(e,e+16);t.material.uniforms.normalTiledMatrix={value:a}}break;case"normalScale":t.material.uniforms&&t.material.uniforms.hasOwnProperty("normalScale")&&t.material.uniforms.normalScale.value.set(i,i);break;case"map":case"diffuseMap":case"normalMap":case"aoMap":case"substanceMap":case"interiorMap":case"colorMap":Se(e,a,n,i);break;case"substanceMin":case"substanceMax":t.material.hasOwnProperty("uniforms")&&t.material.uniforms.hasOwnProperty(n)&&t.material.uniforms[n].value.fromArray(i);break;case"gumColor":t.material.hasOwnProperty("uniforms")&&t.material.uniforms.gumColor.value.set(i);break;case"pattern":if(!t.material.hasOwnProperty("uniforms"))break;if(i.hasOwnProperty("diffuseMap")?Se(e,a,"patternDiffuseMap",i.diffuseMap):Se(e,a,"patternDiffuseMap","null:diffuse"),i.transform){let e=ve(t.material,"pattern",i.transform);if(t.material.uniforms.hasOwnProperty("patternNormalMap")&&null!=e){let r=16*t.material.uniforms.uvFlip.value,a=u.makeNormalMapMatrix(e).slice(r,r+16);t.material.uniforms.patternNormalMatrix={value:a}}}t.material.uniforms.hasOwnProperty("patternDiffuse")&&i.hasOwnProperty("color")&&t.material.uniforms.patternDiffuse.value.set(i.color),i.hasOwnProperty("normalMap")?Se(e,a,"patternNormalMap",i.normalMap):Se(e,a,"patternNormalMap","null:normal"),i.hasOwnProperty("normalScale")&&t.material.uniforms.hasOwnProperty("patternNormalScale")&&(t.material.uniforms.patternNormalScale.value=i.normalScale),i.hasOwnProperty("thickness")&&t.material.uniforms.hasOwnProperty("patternThickness")&&(t.material.uniforms.patternThickness.value=i.thickness),i.hasOwnProperty("substanceMap")?Se(e,a,"patternSubstanceMap",i.substanceMap):Se(e,a,"patternSubstanceMap","null:substance"),i.hasOwnProperty("glossiness")&&t.material.uniforms.hasOwnProperty("patternGlossiness")&&(t.material.uniforms.patternGlossiness.value=i.glossiness),i.hasOwnProperty("specularPower")&&t.material.uniforms.hasOwnProperty("patternSpecularPower")&&(t.material.uniforms.patternSpecularPower.value=i.specularPower);break;case"decal":i.hasOwnProperty("diffuseMap")?Se(e,a,"decalDiffuseMap",i.diffuseMap):Se(e,a,"decalDiffuseMap","null:diffuse"),i.hasOwnProperty("transform")&&ve(t.material,"decal",i.transform);break;case"color":{let e=0,r=i;if(-1!==i.indexOf(":")){let t=i.split(":");r=t[0],e=parseFloat(t[1])}t.material.uniforms&&(t.material.uniforms.hasOwnProperty("diffuse")&&t.material.uniforms.diffuse.value.set(r),t.material.uniforms.hasOwnProperty("emissive")&&(t.material.uniforms.emissive.value.set(r),t.material.uniforms.emissive.value.multiplyScalar(e)))}break;default:t.material.uniforms&&t.material.uniforms.hasOwnProperty(n)?t.material.uniforms[n].value=i:t.material.hasOwnProperty(n)&&(t.material[n]=i)}}t.material.userData.shared.materialType=r,o.hasOwnProperty("colors")&&(t.material.userData.shared.colors=o.colors,t.material.userData.shared.colorName&&He(e,a,t.material.userData.shared.colorName))}),J()}else m("SetComponentMaterial: Invalid shoe id `"+e+"`")}function et(e){k!=e&&(k=e,C.material.opacity=e,J())}function tt(e,t){se(e)?(c[e]&&(de=c[e]),fe=t&&c[e].groups.hasOwnProperty(t)?c[e].groups[t]:null):m("SetActiveShoeId: Invalid shoe id `"+e+"`")}function rt(e){if(!se(e))return m("GetComponentAtCursor: Invalid shoe id `"+e+"`"),[];let t=W.GetPointerPosition(),r=t.x/window.innerWidth,a=t.y/window.innerHeight,n=new THREE.Vector2;return n.set(2*r-1,-2*a+1),p.setFromCamera(n,O),p.intersectObjects(c[e].container.children,!0)}function at(e){if(se(e))return c[e]?c[e].colors:void 0;m("GetColors: Invalid shoe id `"+e+"`")}function nt(e){if(se(e))return c[e]?c[e].materialTypes:void 0;m("GetMaterials: Invalid shoe id `"+e+"`")}function ot(){let e={camera:{position:O.position.toArray(),target:ue.target.toArray()},shoes:{}};for(var t in c){let a=[f(c[t].pose.angle[0])%360,f(c[t].pose.angle[1])%360,f(c[t].pose.angle[2])%360];for(var r=0;r<3;r++)for(;a[r]<0;)a[r]+=360;e.shoes[t]={position:c[t].container.position.toArray(),angle:a}}return e}function it(e,t,r){}function st(e,t){T[e].addListener(t)}function lt(e,t){T[e].removeListener(t)}function ut(){J()}},function(e,t,r){"use strict";THREE.DRACOLoader=function(e,t){this.jobId=1,this.workerQueue=[],this.timeLoaded=0,this.manager=THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode;var r=this;this.worker=new Worker(e),this.worker.addEventListener("message",function(e){if("ready"===e.data)return void(t&&t());let a=-1;r.verbosity>0&&console.log("Worker finished, jobId="+e.data.jobId);for(var n=0;n<r.workerQueue.length;n++)if(e.data.jobId==r.workerQueue[n].jobId){a=n;var o=new THREE.BufferGeometry;for(var i in e.data.attributes)if(e.data.attributes.hasOwnProperty(i)){let t,r=e.data.attributes[i];switch(r.type){case"f32":t=new THREE.Float32BufferAttribute(new Float32Array(r.buffer),r.components);break;case"i8":t=new THREE.Int8BufferAttribute(new Int8Array(r.buffer),r.components);break;case"i16":t=new THREE.Int16BufferAttribute(new Int16Array(r.buffer),r.components);break;case"i32":t=new THREE.Int32BufferAttribute(new Int32Array(r.buffer),r.components);break;case"u8":t=new THREE.Uint8BufferAttribute(new Uint8Array(r.buffer),r.components);break;case"u16":t=new THREE.Uint16BufferAttribute(new Uint16Array(r.buffer),r.components);break;case"u32":t=new THREE.Uint32BufferAttribute(new Uint32Array(r.buffer),r.components)}t?o.addAttribute(i,t):console.log("DRACODecoder: unknown attribute data type: "+r.type)}var s=e.data.indeces.byteLength/Uint32Array.BYTES_PER_ELEMENT;r.verbosity>0&&console.log("index count="+s,o),o.drawMode=THREE.TrianglesDrawMode,s>65535?o.setIndex(new THREE.Uint32BufferAttribute(new Uint32Array(e.data.indeces),1)):o.setIndex(new THREE.Uint16BufferAttribute(new Uint32Array(e.data.indeces),1)),r.workerQueue[a].onLoad(o);break}-1!==a?r.workerQueue.splice(a,1):console.log("Error, unknown job id "+e.data.jobId)});r=this;var a={command:"init",decoderType:"js",scriptPath:"",wasmBinary:null};if(!!window.MSInputMethodContext&&!!document.documentMode)r.verbosity>0&&console.log("DRACOLoader: Using IE decoder."),a.decoderType="js",a.scriptPath=THREE.DRACOLoader.decoderPath+"draco_decoder_ie.js",this.worker.postMessage(a);else if("object"!=typeof WebAssembly)r.verbosity>0&&console.log("DRACOLoader: Using JS decoder."),a.decoderType="js",a.scriptPath=THREE.DRACOLoader.decoderPath+"draco_decoder.js",this.worker.postMessage(a);else{a.decoderType="wasm",a.scriptPath=THREE.DRACOLoader.decoderPath+"draco_wasm_wrapper.js";var n=new THREE.FileLoader;n.setResponseType("arraybuffer"),r.verbosity>0&&console.log("DRACOLoader: Loading wasm decoder."),n.load(THREE.DRACOLoader.decoderPath+"draco_decoder.wasm",function(e){a.wasmBinary=e,r.worker.postMessage(a,[e])})}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,a){var n=this;let o=this.jobId++;this.workerQueue.push({jobId:o,onLoad:t});var i=new THREE.FileLoader(n.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.load(e,function(e){var t=new ArrayBuffer(e.byteLength);new Uint8Array(t).set(new Uint8Array(e)),n.decodeBuffer=t,n.worker.postMessage({command:"decode",jobId:o,buffer:n.decodeBuffer},[n.decodeBuffer])},r,a)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)}},function(e,t){var r,a,n,o,i,s="\n\n    uniform mat4 projector;\n    uniform vec3 projectorPosition;\n\n    varying vec4 shadowProjectionCoord;\n    varying float shadowEyeDist;\n\n",l="\n\n    vec3 transformedShadow = vec3( position );\n    vec4 worldPositionShadow = modelMatrix * vec4( transformedShadow, 1.0 );        \n\n    shadowProjectionCoord = projector * worldPositionShadow;\n    shadowEyeDist = length(worldPositionShadow.xyz - projectorPosition);\n",u="\n\n    uniform float shadowIntensity;\n    uniform sampler2D shadow;\n\n    uniform vec2 shadowSamples[16];\n\n    varying vec4 shadowProjectionCoord;\n    varying float shadowEyeDist;\n\n    float sampleShadowLoop(sampler2D map, vec2 uv, float blurSize) {\n\n        float result = 0.0;\n        const vec2 clamp0 = vec2(0.0,0.0);\n        const vec2 clamp1 = vec2(1.0,1.0);\n        vec2 p;\n\n        #pragma unroll_loop\n        for ( int i = 0; i < 16; i ++ ) {\n            p = clamp(uv + shadowSamples[ i ] * blurSize, clamp0, clamp1);\n            result += texture2D( map, p).r;\n        }\n\n        return (result / 16.0);\n    }\n\n\n    float getSoftShadowContribution() {\n        vec4 shadowCoord = shadowProjectionCoord;\n\n        shadowCoord.xyz /= shadowCoord.w;\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n        bool frustumTest = all( frustumTestVec );\n\n        if(frustumTest) {\n\n            float shadowFalloff = 0.4;\n            \n            float fade = 1.0 - smoothstep(170.0, 190.0, shadowEyeDist);\n\n            float distToCenter = length(vec2(0.5, 0.5) - shadowCoord.xy );\n            distToCenter *= 2.0;\n\n            float circleDist = min(distToCenter, 1.0);\n            \n            fade *= mix(0.0, 1.0, smoothstep(0.0, 0.6, 1.0 - circleDist));\n\n            float blurSize = (1.0 - fade)  * 0.0075;\n            \n            float shadowSample = sampleShadowLoop( shadow, shadowCoord.xy, blurSize);\n\n            fade *= shadowIntensity;\n            return mix( 1.0, shadowSample, fade);\n        } else {\n            return 1.0;\n        }\n    }\n\n",p="\n    float shadow = getSoftShadowContribution();\n    vec4 baseColor = vec4(gl_FragColor.rgb * shadow, 1.0);\n    \n    float distToCenter = length(vec2(0.5, 0.5) - vUv );\n    distToCenter *= 2.0;\n    distToCenter = pow(distToCenter, 8.0);\n    \n    gl_FragColor = mix(baseColor, vec4( diffuse, 0.0), distToCenter);\n    gl_FragColor.a *= 1.0 - shadow;\n";function c(e,t,r){return e.replace(t,t+r)}function d(){n.updateMatrixWorld(),o.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),o.multiply(n.projectionMatrix),o.multiply(n.matrixWorldInverse)}e.exports={Initialize:function(e){a=new THREE.ShaderMaterial({depthTest:!0,depthWrite:!1,blending:THREE.NoBlending,uniforms:{},vertexShader:"\n            void main()        {\n                vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n                gl_Position = projectionMatrix * modelViewPosition;\n            }",fragmentShader:"\n            void main()        {\n                gl_FragColor = vec4(0, 0, 0, 1.0 );\n            }"}),r=new THREE.WebGLRenderTarget(1024,1024,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,depthBuffer:!1,stencilBuffer:!1,format:THREE.RGBFormat,anisotropy:4,generateMipmaps:!1}),o=new THREE.Matrix4,n=e},Update:d,CreateMaterial:function(e){i={shadow:{value:r.texture},projector:{value:o},projectorPosition:{value:n.position},shadowIntensity:{value:1}};for(var t=new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:1,emissive:0,map:e,depthTest:!0,depthWrite:!1}),a=[],d=-2;d<2;d++)for(var f=-2;f<2;f++)a.push(d),a.push(f);return t.onBeforeCompile=function(e){e.uniforms.shadowSamples={value:a},e.uniforms.shadow=i.shadow,e.uniforms.projector=i.projector,e.uniforms.projectorPosition=i.projectorPosition,e.uniforms.shadowIntensity=i.shadowIntensity,e.vertexShader=s+e.vertexShader,e.fragmentShader=u+e.fragmentShader,e.vertexShader=c(e.vertexShader,"void main() {",l),e.fragmentShader=c(e.fragmentShader,"#include <dithering_fragment>",p)},t},Render:function(e,t){d(),e.autoClear=!0,e.setClearColor(16777215,1),t.overrideMaterial=a,e.render(t,n,r)},SetIntensity:function(e){i.shadowIntensity.value=e}}},function(e,t){function r(e){return e*Math.PI/180}var a=function(){this.easedValues=[]};a.prototype.AddValue=function(e){this.easedValues.push(e)},a.prototype.Update=function(e){var t=!1;let r=Math.min(e,.5);for(var a=0;a<this.easedValues.length;a++){t=this.easedValues[a].Update(r)||t}return t};var n=new a;function o(e){this.targetObject=e,this.current=new THREE.Quaternion,this.target=new THREE.Quaternion,this.velocity=0,this.tempEuler=new THREE.Euler,this.tempVec=new THREE.Vector3,this.epsilon=1e-4,this.easing=5,this.running=!0,n.AddValue(this)}function i(e){this.targetObject=e,this.epsilon=1e-5,this.velocity=new THREE.Vector3,this.start=new THREE.Vector3,this.current=new THREE.Vector3,this.target=new THREE.Vector3,this.tempVec=new THREE.Vector3,this.easing=8,this.running=!0,this.DECELERATION=7,this.ACCELERATION=5,this.TOPSPEED=20,this.moveTime=0,this.moveSpeed=20,this.moveDuration=0,n.AddValue(this)}o.prototype.setTargetObject=function(e){this.targetObject=e},o.prototype.Update=function(e){if(this.running){if(this.current.slerp(this.target,e*this.easing),this.current.angleTo(this.target)<this.epsilon)return this.current.copy(this.target),this.velocity=0,this.running=!1,!0}return this.running},o.prototype.rotateBy=function(e,t){t?(this.target.multiplyQuaternions(e,this.target),this.current.multiplyQuaternions(e,this.current),this.running=!0):(this.running=!0,this.target.multiplyQuaternions(e,this.target))},o.prototype.Set=function(e,t){if(this.running=!0,Array.isArray(e)){var a=[r(e[0]),r(e[1]),r(e[2])];this.tempEuler.fromArray(a),t&&this.current.setFromEuler(this.tempEuler),this.target.setFromEuler(this.tempEuler)}else e.prototype==THREE.Vector3?(this.tempVec.copy(e),this.tempVec.multiplyScalar(Math.PI/180),this.tempEuler.setFromVector3(this.tempVec),t&&this.current.setFromEuler(this.tempEuler),this.target.setFromEuler(this.tempEuler)):(this.target.copy(e),t&&this.current.copy(e))},i.prototype.Update=function(e){var t;return this.running&&(this.moveTime+=e,this.moveTime<this.moveDuration/2?(this.current.lerpVectors(this.start,this.target,(t=this.moveTime/this.moveDuration)<.5?8*t*t*t*t:1-8*--t*t*t*t),this.moveTime>=this.moveDuration&&(this.current.copy(this.target),this.running=!1)):(this.current.lerp(this.target,7*e),this.current.distanceToSquared(this.target)<this.epsilon&&(this.current.copy(this.target),this.running=!1))),this.running},i.prototype.Set=function(e,t){Array.isArray(e)?this.target.fromArray(e):this.target.copy(e),t?(this.current.copy(this.target),this.running=!1):(this.running||(this.start.copy(this.current),this.moveTime=0,this.moveDuration=Math.min(1.25,Math.max(.75,this.current.distanceTo(this.target)/this.moveSpeed))),this.running=!0)},e.exports={EasedPosition:i,EasedRotation:o,Manager:n}},function(e,t,r){const a=r(0),n=r(1);var o=function(){this.startDragPosition={x:0,y:0},this.previousPosition={x:0,y:0},this.dragDistanceThreshold=10,this.moveScale=.2,this.hasDragged=!1,this.dragDistance=0,this.pointerDown=!1,this.constrained=!1,this.enabled=!0,this.deltaRadians=[0,0],this.limits=[0,0],this.OnDrag=null,this.dragVelocity=[0,0],this.dragTarget=[0,0],this.dragPosition=[0,0],this.touchId=null,this.tmpQuaternion=new THREE.Quaternion,this.tmpEuler=new THREE.Euler,this.OnDrag=new n.EventEmitter,this.OnClick=new n.EventEmitter,this.OnMove=new n.EventEmitter,this.OnDragStartStop=new n.EventEmitter};o.prototype.Initialize=function(e,t,r,a,n){this.OnDrag.addListener(t),this.OnClick.addListener(r),this.OnMove.addListener(a),this.OnDragStartStop.addListener(n);let o=this;e.addEventListener("mousedown",function(e){!o._pointerDown({x:e.clientX,y:e.clientY})&&o._stopEvent(e)}),window.addEventListener("mousemove",function(e){!o._pointerMove({x:e.clientX,y:e.clientY})&&o._stopEvent(e)}),window.addEventListener("mouseup",function(e){!o._pointerUp({x:e.clientX,y:e.clientY})&&o._stopEvent(e)}),e.addEventListener("touchstart",function(e){o.pointerDown||(o.touchId=e.touches[0].identifier,o._pointerDown({x:e.touches[0].clientX,y:e.touches[0].clientY},!0)),o._stopEvent(e)}),window.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;t++)if(e.changedTouches[t].identifier==o.touchId){!o._pointerMove({x:e.changedTouches[t].clientX,y:e.changedTouches[t].clientY},!0)&&o._stopEvent(e)}}),window.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;t++)if(e.changedTouches[t].identifier==o.touchId){!o._pointerUp({x:e.clientX,y:e.clientY},!0)&&o._stopEvent(e)}})},o.prototype.ResetConstraints=function(){this.deltaRadians[0]=0,this.deltaRadians[1]=0},o.prototype.SetDragMode=function(e,t){this.enabled=e,this.constrained=null!=t,this.enabled&&this.constrained&&(this.deltaRadians[0]=0,this.deltaRadians[1]=0,this.dragVelocity=[0,0],this.dragTarget=[0,0],this.dragPosition=[0,0],t.hasOwnProperty("x")&&null!=t.x?this.limits[0]=a.toRadians(t.x):this.limits[0]=null,t.hasOwnProperty("y")&&null!=t.y?this.limits[1]=a.toRadians(t.y):this.limits[1]=null)},o.prototype._pointerMove=function(e,t){if(!this.pointerDown||!this.enabled)return this.OnMove.emit(e.x,e.y),!0;let r=Math.pow(this.startDragPosition.y-this.previousPosition.y,2),n=Math.pow(this.startDragPosition.x-this.previousPosition.x,2);this.dragDistance=Math.sqrt(r+n);let o=!1;this.dragDistance>this.dragDistanceThreshold&&(this.hasDragged||(o=!0),this.hasDragged=!0);var i=e.x-this.previousPosition.x,s=e.y-this.previousPosition.y;if(this.previousPosition={x:e.x,y:e.y},this.pointerDown&&this.enabled&&this.hasDragged){let e=[a.toRadians(i*this.moveScale),a.toRadians(s*this.moveScale)];if(this.constrained)for(var l=0;l<2;l++)if(null!==this.limits[l]){let t=e[l]+this.deltaRadians[l];t>this.limits[l]?e[l]=this.limits[l]-this.deltaRadians[l]:t<-this.limits[l]&&(e[l]=-this.limits[l]-this.deltaRadians[l]),this.deltaRadians[l]+=e[l]}return this.dragTarget=e,this.tmpEuler.set(e[1],e[0],0),this.tmpQuaternion.setFromEuler(this.tmpEuler),o&&this.OnDragStartStop.emit(!0),this.hasDragged=!0,this.OnDrag.emit(this.tmpQuaternion,new THREE.Vector3(e[1],e[0],0)),!1}},o.prototype._pointerDown=function(e,t){return this.moveScale=t?.4:.2,this.OnMove.emit(e.x,e.y),this.pointerDown=!0,this.hasDragged=!1,this.dragDistance=0,this.startDragPosition.x=e.x,this.startDragPosition.y=e.y,this.previousPosition.x=e.x,this.previousPosition.y=e.y,!0},o.prototype._pointerUp=function(e,t){return this.pointerDown&&this.dragDistance<this.dragDistanceThreshold?(this.pointerDown=!1,this.OnClick.emit(e.x,e.y)):(this.OnDragStartStop.emit(!1),this.pointerDown=!1),!0},o.prototype._stopEvent=function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1},o.prototype.GetPointerPosition=function(){return this.previousPosition},e.exports=o},function(e,t,r){const a=r(0),n=r(2),o=.01,i=1;var s,l,u,p,c="",d="",f=1,m=!0,h=[],E={},v={},g={shoes:{},vertices:0,triangles:0},w={materials:!1,draco:!1};function y(){let e=!0;return m&&(e=e&&w.draco),e=e&&w.materials}function T(e){return 0!==e.indexOf("/")?c+"/"+e:c+e}function M(e){return 0!==e.indexOf("/")?d+"/"+e:d+e}function R(e){let t="#ffffff",r="#000000",a=0;if(e){if(-1!==(t=e).indexOf(":")){let e=t.split(":");t=e[0],a=parseFloat(e[1])}if(a>0){let e=new THREE.Color(t);e.multiplyScalar(a),r="#"+e.getHexString()}}return{color:t,emissive:r,boost:a}}function P(e,t,r){v[e].pendingAssets--;let a=(v[e].totalAssets-v[e].pendingAssets)/v[e].totalAssets;t(v[e].pendingAssets<=0,a)}function O(e,t,r,a){let n=!!t.hasOwnProperty("isShadow")&&t.hasOwnProperty("isShadow"),o=!!t.hasOwnProperty("isBounds")&&t.hasOwnProperty("isBounds"),i=new THREE.Mesh(r,a||new THREE.MeshBasicMaterial({color:16711935}));i.name=e,i.visible=!1,t.hasOwnProperty("renderOrder")?(i.renderOrder=t.renderOrder,i.userData.renderOrder=t.renderOrder):a&&a.userData.renderOrder&&(i.renderOrder=a.userData.renderOrder,i.userData.renderOrder=a.userData.renderOrder);for(var s=new THREE.Vector3,l=0;l<r.attributes.position.count;l++)s.x+=r.attributes.position.array[3*l],s.y+=r.attributes.position.array[3*l+1],s.z+=r.attributes.position.array[3*l+2];return s.divideScalar(r.attributes.position.count),i.userData.centerPoint=s,i.userData.isShadow=n,i.userData.isBounds=o,o&&(i.visible=!1),i}function x(e,t){var r=["map","aoMap","normalMap","normalMapModel","interiorMap","alphaMap","diffuseMap","specularMap","colorMap","substanceMap","colorSGMap","glossinessMap","roughnessMap","bumpMap"];for(var a in t)if(-1!==r.indexOf(a)){let r=t[a];-1===r.indexOf(":")&&e.textures.hasOwnProperty(r)&&(e.textures[r].default,e.textures[r].default=!0)}}function S(e,t){for(var r=0;r<h.length;r++)if(h[r].url==e)return h[r].refCount++,t(h[r].texture),h[r].texture;let a=l.load(T(e),t);return a.name=e,h.push({texture:a,url:e,refCount:1}),a}function D(e,t,r,a){if(e.hasOwnProperty(r)){let o=e[r];if(0===o.indexOf("canvas:")){let e=o.substring("canvas:".length);for(var n in a.canvases)if(-1!==n.indexOf(e))return void(t[r]=a.canvases[n].texture)}if(0===o.indexOf("null:")){let e=o.substring("null:".length);if(E.hasOwnProperty(e))return void(t[r]=E[e])}null!=a.textures[o]&&(t[r]=a.textures[o].texture)}}function b(e,t,r,a){e.hasOwnProperty(r)?t[r]=e[r]:null!==a&&(t[r]=a)}function A(e,t){if(!e)return{offset:[0,0],scale:[1,1],angle:0,mirrorAngle:!0,mirrorX:!1};let r=e.hasOwnProperty("offset")?e.offset:[0,0],a=e.hasOwnProperty("scale")?e.scale:[1,1],n=e.hasOwnProperty("angle")?e.angle:0;Array.isArray(r)||(r=[r,r]),Array.isArray(a)||(a=[a,a]);let o=!0;e.hasOwnProperty("mirrorAngle")&&(o=e.mirrorAngle);let i=!1;if(e.hasOwnProperty("mirrorX")&&(i=e.mirrorX),t){let e=A(t);return{offset:[r[0]+e.offset[0],r[1]+e.offset[1]],scale:[a[0]*e.scale[0],a[1]*e.scale[1]],angle:n+e.angle,mirrorAngle:o,mirrorX:i}}return{offset:r,scale:a,angle:n,mirrorAngle:o,mirrorX:i}}function H(e,t){for(var r in e)"pattern"==r||"decal"==r?(t.hasOwnProperty(r)||(t[r]={}),H(e[r],t[r])):t[r]="transform"==r?A(e[r]):e[r]}function C(e,t,r,s){let l="standard",u="",c={};if(H(r,c),r.hasOwnProperty("transform")&&(c.transform=A()),r.hasOwnProperty("pattern")&&r.pattern.hasOwnProperty("transform")&&(c.pattern.transform=A()),r.hasOwnProperty("decal")&&r.pattern.hasOwnProperty("decal")&&(c.decal.transform=A()),r.hasOwnProperty("material")){let e=r.material.split(",");for(var d=0;d<e.length;d++)u=e[d],H(materialTypes[u],c)}r.hasOwnProperty("transform")&&(c.transform=A(c.transform,r.transform)),r.hasOwnProperty("pattern")&&r.pattern.hasOwnProperty("transform")&&(c.pattern.transform=A(c.pattern.transform,r.pattern.transform)),r.hasOwnProperty("decal")&&r.pattern.hasOwnProperty("decal")&&(c.decal.transform=A(c.decal.transform,r.decal.transform)),null!==c.type&&(l=c.type);let f={},m={},h=null;if(c.hasOwnProperty("color")){let t=c.color;0===t.indexOf("#")?f.color=t:(h=t,e.colors.hasOwnProperty(t)&&(f.color=e.colors[t]),c.hasOwnProperty("colors")&&c.colors.hasOwnProperty(t)&&(f.color=c.colors[t]))}let E=R(f.color);f.color=E.color,f.emissive=E.emissive,b(c,f,"specularColor","#ffffff"),b(c,f,"metalness",0),b(c,f,"roughness",1),b(c,f,"opacity",1),D(c,f,"diffuseMap",s),D(c,f,"bumpMap",s),D(c,f,"normalMap",s),D(c,m,"colorMap",s),b(c,m,"colorCount",2),b(c,m,"colorSteps",1),D(c,f,"alphaMap",s),D(c,f,"roughnessMap",s),D(c,f,"aoMap",s),D(c,m,"normalMapModel",s),f.aoMapIntensity=1.15;let v=[0,0,0,0];var g,w,y,T;v[r.hasOwnProperty("aoChannel")?r.aoChannel:0]=1,m.aoChannelMask=new THREE.Vector4(v[0],v[1],v[2],v[3]),w=f,y="normalScale",(g=c).hasOwnProperty(y)?w[y]=new THREE.Vector2(g[y],g[y]):null!=T&&(w[y]=new THREE.Vector2(T,T)),D(c,m,"maskMap",s),a.isIE11()&&(f.polygonOffset=!0,f.polygonOffsetFactor=0),f.envMap=p;let M=null;switch(l){case"transparent":f.transparent=!0,D(c,f,"map",s),(M=new THREE.MeshPhysicalMaterial(f)).userData.aoMapChannel={value:m.aoChannelMask},M.onBeforeCompile=function(e){e.uniforms.aoMapChannel=M.userData.aoMapChannel};break;case"translucent":m.transform=A(c.transform),!!c.hasOwnProperty("useAOMap")&&c.useAOMap&&D(c,f,"aoMap",s),b(c,f,"specularPower",i),b(c,f,"glossiness",o),b(c,f,"normalScale",1),D(c,m,"interiorMap",s),b(c,m,"interiorDepth",-.015),b(c,m,"gumMix",.7),b(c,m,"interiorIntensity",.75),b(c,m,"gumColor","#b5c6d4"),M=n.CreateTranslucentMaterial(f,m);break;case"decal-geo":f.transparent=!0,f.depthTest=!0,f.depthWrite=!1,f.cutout=!0;case"iridescent":m.transform=A(c.transform),b(c,f,"specularPower",i),b(c,f,"glossiness",o),b(c,f,"normalScale",1),b(c,f,"polygonOffsetFactor",0),M=n.CreateIridescentMaterial(f,m);break;case"tiled_":m.transform=A(c.transform),b(c,f,"specularPower",i),b(c,f,"glossiness",o),b(c,f,"normalScale",1);var P=f.hasOwnProperty("transparent")&&f.transparent;if(b(c,f,"transparent",P),b(c,m,"translucent",!1),b(c,m,"opticalDensity",0),b(c,f,"useEnvMap",!1),b(c,f,"reflectivity",0),b(c,m,"renderOrder",1),(!c.hasOwnProperty("useAOMap")||c.useAOMap)&&D(e,f,"aoMap",s),D(c,m,"substanceMap",s),b(c,m,"substanceMin",[0,0,0]),b(c,m,"substanceMax",[1,1,1]),b(c,f,"side","front"),b(c,f,"side","front"),b(c,f,"polygonOffsetFactor",0),c.hasOwnProperty("pattern")){m.pattern={};let e=R(c.pattern.color);m.pattern.color=e.color,m.pattern.emissive=e.emissive,b(c.pattern,m.pattern,"normalScale",1),D(c.pattern,m.pattern,"diffuseMap",s),D(c.pattern,m.pattern,"normalMap",s),D(c.pattern,m.pattern,"substanceMap",s),b(c.pattern,m.pattern,"glossiness",o),b(c.pattern,m.pattern,"specularPower",i),b(c.pattern,m.pattern,"thickness",.95),b(c.pattern,m.pattern,"tintThreshold",0),b(c.pattern,m.pattern,"transform",{}),m.pattern.transform=A(m.pattern.transform)}if(c.hasOwnProperty("decal")){m.decal={};let e=R(c.decal.color);m.decal.color=e.color,b(c.decal,m.decal,"glossiness",o),b(c.decal,m.decal,"specularPower",i),b(c.decal,m.decal,"thickness",1),b(c.decal,m.decal,"tintThreshold",0),b(c.decal,m.decal,"transform",{}),m.decal.transform=A(m.decal.transform),D(c.decal,m.decal,"diffuseMap",s),D(c.decal,m.decal,"normalMap",s)}M=n.CreateTiledMaterial_(f,m);break;default:M=new THREE.MeshBasicMaterial({color:16711935})}return M&&(M.name=t,M.userData.hasOwnProperty("shared")||(M.userData.shared={}),M.userData.shared.info=r,M.userData.shared.shaderType=l,M.userData.shared.materialType=u,M.userData.shared.materialGroup=t,M.userData.shared.colorName=h,M.userData.shared.colors=c.hasOwnProperty("colors")?c.colors:{},"decal-geo"!=l&&"transparent"!=l||(M.userData.renderOrder+=1),M.userData.shared.baseTiledTransform=A(r.transform),r.hasOwnProperty("pattern")&&(M.userData.shared.basePatternTransform=A(r.pattern.transform)),r.hasOwnProperty("decal")&&(M.userData.shared.baseDecalTransform=A(r.decal.transform))),M}function L(e,t,r){let a=0,n=r.attributes.position.count;a=null!==r.index?r.index.count/3:n/3,g.shoes.hasOwnProperty(e)||(g.shoes[e]={models:{},triangles:0,vertices:0}),g.shoes[e].models[t]={triangles:a,vertices:n},g.shoes[e].triangles+=a,g.shoes[e].vertices+=n,g.triangles+=a,g.vertices+=n}e.exports={Initialize:function(e,t){if(f=e.maxAnisotropy,c=e.hasOwnProperty("content_root")?e.content_root:"",d=e.hasOwnProperty("source_root")?e.source_root:"",l=new THREE.TextureLoader,u=new THREE.CubeTextureLoader,function(){let e={white:[255,255,255,255],diffuse:[255,255,255,0],normal:[128,128,255,255],substance:[255,255,255,0]};for(var t in e){for(var r=new Uint8Array(4),a=0;a<4;a++)r[a]=e[t][a];let n=new THREE.DataTexture(r,1,1,THREE.RGBAFormat);n.name="null:"+t,n.wrapS=n.wrapT=THREE.ClampToEdgeWrapping,n.minFilter=THREE.NearestFilter,n.magFilter=THREE.NearestFilter,n.generateMipmaps=!1,n.needsUpdate=!0,E[t]=n}}(),n.Initialize(M("shaders/"),function(){w.materials=!0,y()&&t()}),m){let r=e.hasOwnProperty("draco_decoder")?e.draco_decoder:"draco/",a=e.hasOwnProperty("draco_worker")?e.draco_worker:"draco/draco_worker.min.js";THREE.DRACOLoader.setDecoderPath(M(r)),s=new THREE.DRACOLoader(M(a),function(){w.draco=!0,y()&&t()})}else y()&&t()},LoadManifest:function(e,t,r,a){(new THREE.FileLoader).load(T(e),function(e){let o=JSON.parse(e);t(o.id,function(e,t){let r={boundsObjects:[],pendingAssets:0,totalAssets:0,textures:{},canvases:{},models:{},groups:{},materials:{},materialTypes:e["material-types"],container:new THREE.Object3D,colors:e.colors,attachments:e.hasOwnProperty("attachments")?e.attachments:{}};for(var a in r.container.name=e.id,r.attachments){let e=r.attachments[a];e.position=(new THREE.Vector3).fromArray(e.position),e.normal=(new THREE.Vector3).fromArray(e.direction);var o=(new THREE.Matrix4).lookAt(e.normal,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));e.quaternion=(new THREE.Quaternion).setFromRotationMatrix(o)}for(var i in v[e.id]=r,materialTypes=e["material-types"],e.hasOwnProperty("aoMap")&&x(e,e),e.materials){if(x(e,e.materials[i]),e.materials[i].hasOwnProperty("material")){let t=e.materials[i].material.split(",");for(var l=0;l<t.length;l++){let r=materialTypes[t[l]];x(e,r),r.hasOwnProperty("decal")&&x(e,r.decal),r.hasOwnProperty("pattern")&&x(e,r.pattern)}}e.materials[i].hasOwnProperty("decal")&&x(e,e.materials[i].decal),e.materials[i].hasOwnProperty("pattern")&&x(e,e.materials[i].pattern)}for(var u in e.geometry){let t=e.geometry[u];for(var i in t)t[i].hasOwnProperty("aoMap")&&x(e,t[i]),r.pendingAssets++,r.totalAssets++}for(var i in e.textures)e.textures[i].default&&(r.pendingAssets++,r.totalAssets++);for(var i in e.textures){let a=i+"",n=e.textures[a].url,o=!e.textures[a].hasOwnProperty("repeat")||e.textures[a].repeat,s=!e.textures[a].hasOwnProperty("filtering")||e.textures[a].filtering,l=!e.textures[a].hasOwnProperty("mipmaps")||e.textures[a].mipmaps,u=e.textures[a].hasOwnProperty("anisotropy")?e.textures[a].anisotropy:1;u=Math.min(u,f),0!==n.indexOf("/")&&(n=e.contentRoot+"/"+n),r.textures[a]={texture:null,url:n,repeat:o,filtering:s,mipmaps:l},e.textures[a].default&&(r.textures[a].texture=S(n,function(){r.textures[a].ready=!0,P(e.id,t)}),r.textures[a].name=a,r.textures[a].texture.name=a,r.textures[a].texture.anisotropy=u,r.textures[a].texture.wrapS=r.textures[a].texture.wrapT=o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l||(r.textures[a].texture.minFilter=THREE.LinearFilter,r.textures[a].texture.generateMipmaps=!1),s||(r.textures[a].texture.minFilter=THREE.NearestFilter,r.textures[a].texture.magFilter=THREE.NearestFilter))}for(var p in e.canvases){let t=n.CreateCanvas(e.canvases[p].width,e.canvases[p].height);r.canvases[p]={width:e.canvases[p].width,height:e.canvases[p].height,element:t,context:t.getContext("2d"),texture:new THREE.CanvasTexture(t,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping)},r.canvases[p].texture.minFilter=THREE.LinearFilter,r.canvases[p].texture.generateMipmaps=!1}for(var i in e.materials){let t=i+"";r.materials[t]=C(e,t,e.materials[i],r)}let c=new THREE.Vector3;e.hasOwnProperty("scale")&&c.set(e.scale,e.scale,e.scale);let d=new THREE.Vector3;for(var u in e.hasOwnProperty("position-offset")&&d.fromArray(e["position-offset"]),e.geometry){let a=u,n=e.geometry[a],o=new THREE.Group;for(var i in o.name=a,r.groups[a]=o,r.container.add(o),n){let l=i+"",u=n[l].url,p=n[l].material,f=n[l];0!==u.indexOf("/")&&(u=e.contentRoot+"/"+u),-1!==u.indexOf(".drc")&&s.load(T(u),function(n){var i=null;if(e.materials[p]){for(var s in(i=r.materials[p].clone()).userData.shared=r.materials[p].userData.shared,r.materials[p].uniforms)i.uniforms[s]=r.materials[p].uniforms[s];if(i.hasOwnProperty("uniforms")&&i.uniforms.hasOwnProperty("uvFlip")){let e=!!f.hasOwnProperty("uvMirror")&&f.uvMirror;if(i.uniforms.uvFlip={value:e?1:0},i.uniforms.hasOwnProperty("normalTiledMatrix")){let e=16*i.uniforms.uvFlip.value,t=i.userData.shared.normalTiledMatrix.slice(e,e+16);i.uniforms.normalTiledMatrix={value:t}}if(i.uniforms.hasOwnProperty("patternNormalMatrix")){let e=16*i.uniforms.uvFlip.value,t=i.userData.shared.patternNormalMatrix.slice(e,e+16);i.uniforms.patternNormalMatrix={value:t}}let t=[0,0,0,0];t[f.hasOwnProperty("aoChannel")?f.aoChannel:0]=1,i.uniforms.aoChannelMask={value:(new THREE.Vector4).fromArray(t)}}}r.models[l]=O(l,f,n,i),r.models[l].position.copy(d),r.models[l].scale.copy(c),r.models[l].name=l,o.add(r.models[l]),L(e.id,l,r.models[l].geometry),r.models[l].userData.isBounds&&(r.models[l].userData.group=a,r.models[l].userData.shoe=e.id,r.boundsObjects.push(r.models[l])),P(e.id,t)})}}return r.container}(o,function(e,t){e?r&&r(o.id,v[o.id]):a&&a(t)}))},function(e){},function(e){})},LoadEnvironmentMap:function(e,t){return u.setPath(T(t)),p=u.load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"])},GetTileParams:A,GetTexture:S,GetNullTexture:function(e){return E.hasOwnProperty(e)?E[e]:null}}}]);